/* Worki Tracker v3.3 | tracker.workidigital.tech */
!function () { 'use strict'; var cs = document.currentScript || document.querySelector('script[src*="wk.js"]'); var PID = cs ? cs.getAttribute('data-project') || 1 : 1; var PKEY = cs ? cs.getAttribute('data-key') : null; var C = { endpoint: 'https://tracker.workidigital.tech/api/track/events', geoEndpoint: 'https://tracker.workidigital.tech/api/track/geo', batch: 5e3, scroll: [25, 50, 75, 90, 100] }; function gid(p) { return p + '_' + Date.now().toString(36) + '_' + Math.random().toString(36).substring(2, 10) } function vid() { var i = localStorage.getItem('wk_vid_' + PID); if (!i) { i = gid('wk'); localStorage.setItem('wk_vid_' + PID, i) } return i } function sid() { var i = sessionStorage.getItem('wk_sid_' + PID); if (!i) { i = gid('ws'); sessionStorage.setItem('wk_sid_' + PID, i) } return i } function fp() { var f = [navigator.userAgent, navigator.language, screen.width + 'x' + screen.height, screen.colorDepth, new Date().getTimezoneOffset(), navigator.hardwareConcurrency || 0, navigator.maxTouchPoints || 0, navigator.platform || '', window.devicePixelRatio || 1].join('|'), h = 0; for (var i = 0; i < f.length; i++) { h = ((h << 5) - h) + f.charCodeAt(i); h |= 0 } return 'fp_' + Math.abs(h).toString(36) } function utm() { var p = new URLSearchParams(window.location.search); return { source: p.get('utm_source') || null, medium: p.get('utm_medium') || null, campaign: p.get('utm_campaign') || null, term: p.get('utm_term') || null, content: p.get('utm_content') || null, fbclid: p.get('fbclid') || null } } function ck(n) { var m = document.cookie.match(new RegExp('(?:^|; )' + n + '=([^;]*)')); return m ? decodeURIComponent(m[1]) : null } function dev() { var u = navigator.userAgent, t = 'desktop'; if (/Mobi|Android/i.test(u)) t = 'mobile'; else if (/Tablet|iPad/i.test(u)) t = 'tablet'; var o = 'unknown'; if (/Windows/i.test(u)) o = 'Windows'; else if (/Android/i.test(u)) o = 'Android'; else if (/iPhone|iPad/i.test(u)) o = 'iOS'; else if (/Mac/i.test(u)) o = 'macOS'; else if (/Linux/i.test(u)) o = 'Linux'; var b = 'unknown'; if (/Edg/i.test(u)) b = 'Edge'; else if (/OPR|Opera/i.test(u)) b = 'Opera'; else if (/Chrome/i.test(u)) b = 'Chrome'; else if (/Safari/i.test(u)) b = 'Safari'; else if (/Firefox/i.test(u)) b = 'Firefox'; return { type: t, os: o, browser: b, screen: screen.width + 'x' + screen.height } } var geo = { city: null, state: null, country: null, zip_code: null }; function fgeo() { return fetch(C.geoEndpoint).then(function (r) { return r.json() }).then(function (d) { if (d && d.city) { geo.city = d.city; geo.state = d.state; geo.country = d.country; geo.zip_code = d.zip_code } }).catch(function () { }) } var V = vid(), S = sid(), F = fp(), q = [], st = Date.now(), ss = {}; function pe(e, d) { q.push({ project_id: PID, visitor_id: V, session_id: S, fingerprint: F, event: e, page: location.pathname, url: location.href, timestamp: new Date().toISOString(), data: d || {} }) } function fl() { if (!q.length) return; var b = q.splice(0, 50); fetch(C.endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(b), keepalive: true, mode: 'cors' }).catch(function () { }) } fgeo().finally(function () { pe('pageview', { utm: utm(), referrer: document.referrer || null, device: dev(), fbc: ck('_fbc') || null, fbp: ck('_fbp') || null, geo: geo, title: document.title }); fl(); if (typeof fbq !== 'undefined') fbq('track', 'PageView') }); function sp() { var h = document.documentElement, b = document.body, t = window.scrollY || h.scrollTop || b.scrollTop, s = Math.max(h.scrollHeight, b.scrollHeight) - window.innerHeight; return s <= 0 ? 100 : Math.round(t / s * 100) } var sT = null; window.addEventListener('scroll', function () { clearTimeout(sT); sT = setTimeout(function () { var p = sp(); C.scroll.forEach(function (t) { if (p >= t && !ss[t]) { ss[t] = true; pe('scroll', { depth: t + '%' }) } }) }, 200) }, { passive: true }); document.addEventListener('click', function (e) { var el = e.target.closest('a, button, [data-track]'); if (!el) return; var hr = el.getAttribute('href') || '', tx = (el.innerText || '').substring(0, 100).trim(), tg = el.tagName.toLowerCase(); if (hr.includes('wa.me') || hr.includes('whatsapp') || hr.includes('api.whatsapp')) { var pm = hr.match(/[\d+]{10,}/); pe('click', { type: 'whatsapp_click', phone: pm ? pm[0] : '', href: hr, text: tx }); fl(); return } if (hr.startsWith('tel:')) { pe('click', { type: 'phone_click', phone: hr.replace('tel:', '').replace(/\D/g, ''), href: hr, text: tx }); fl(); return } pe('click', { type: 'general', tag: tg, text: tx, href: hr.substring(0, 200), id: el.id || null }) }); document.addEventListener('submit', function (e) { var fm = e.target; if (!fm || fm.tagName !== 'FORM') return; var fi = {}, ip = fm.querySelectorAll('input, select, textarea'); ip.forEach(function (i) { var n = (i.name || i.id || i.placeholder || '').toLowerCase(), v = i.value; if (!n || !v || i.type === 'password' || i.type === 'hidden') return; if (n.match(/nome|name|full.?name/i)) fi.nome = v; else if (n.match(/email|e-mail|e_mail/i)) fi.email = v; else if (n.match(/tel|phone|fone|whats|celular|whatsapp/i)) fi.telefone = v; else if (n.match(/empresa|company|loja|negocio/i)) fi.empresa = v; else if (n.match(/instagram|insta|ig/i)) fi.instagram = v; else fi[n] = v }); if (Object.keys(fi).length > 0) { pe('form_submit', { fields: fi, formId: fm.id || null, formAction: fm.action || null }); fl(); if (typeof fbq !== 'undefined') fbq('track', 'Lead') } }); function hb() { if (document.visibilityState === 'visible') pe('heartbeat', { ts: Date.now() }); fl(); } setInterval(hb, 15000); function ox() { var t = Math.round((Date.now() - st) / 1000); pe('page_exit', { time_on_page: t, scroll_depth: sp() + '%' }); fl() } window.addEventListener('beforeunload', ox); document.addEventListener('visibilitychange', function () { if (document.visibilityState === 'hidden') ox() }); setInterval(fl, C.batch); window.WorkiTracker = { identify: function (d) { pe('identify', d); fl() }, convert: function (d) { pe('conversion', d); fl(); if (typeof fbq !== 'undefined') fbq('track', 'Purchase', { value: d.value || 0, currency: 'BRL' }) }, vid: function () { return V }, sid: function () { return S } } }();
