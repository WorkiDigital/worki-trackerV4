<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Worki Tracker v2.6</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #080a10;
      --bg2: #0d1017;
      --glass: rgba(15, 20, 32, 0.7);
      --glass2: rgba(20, 28, 45, 0.6);
      --border: rgba(255, 255, 255, 0.06);
      --border2: rgba(255, 255, 255, 0.1);
      --text: #e8ecf4;
      --text2: #8b95a8;
      --text3: #505a6e;
      --emerald: #00d4aa;
      --emerald-g: rgba(0, 212, 170, 0.12);
      --emerald-d: #00a885;
      --cyan: #22d3ee;
      --blue: #3b82f6;
      --purple: #a78bfa;
      --pink: #f472b6;
      --orange: #fb923c;
      --orange-g: rgba(251, 146, 60, 0.12);
      --red: #f87171;
      --red-g: rgba(248, 113, 113, 0.12);
      --yellow: #fbbf24;
      --radius: 14px;
      --radius-sm: 8px;
      --scheme: dark
    }

    [data-theme="light"] {
      --bg: #f0f2f5;
      --bg2: #ffffff;
      --glass: rgba(255, 255, 255, 0.85);
      --glass2: rgba(245, 247, 250, 0.9);
      --border: rgba(0, 0, 0, 0.08);
      --border2: rgba(0, 0, 0, 0.12);
      --text: #1a1d23;
      --text2: #4a5568;
      --text3: #8b95a8;
      --emerald: #00b894;
      --emerald-g: rgba(0, 184, 148, 0.1);
      --emerald-d: #009b7d;
      --cyan: #0891b2;
      --blue: #2563eb;
      --purple: #7c3aed;
      --pink: #db2777;
      --orange: #ea580c;
      --orange-g: rgba(234, 88, 12, 0.1);
      --red: #dc2626;
      --red-g: rgba(220, 38, 38, 0.1);
      --yellow: #d97706;
      --scheme: light
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      color-scheme: var(--scheme)
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 20% 50%, rgba(0, 212, 170, 0.03), transparent 50%), radial-gradient(ellipse at 80% 20%, rgba(59, 130, 246, 0.03), transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    [data-theme="light"] body::before {
      background: radial-gradient(ellipse at 20% 50%, rgba(0, 184, 148, 0.05), transparent 50%), radial-gradient(ellipse at 80% 20%, rgba(37, 99, 235, 0.04), transparent 50%)
    }

    .settings-section {
      margin-bottom: 28px
    }

    @keyframes pulse-live {
      0% {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 212, 170, 0.7);
      }

      70% {
        opacity: 0.7;
        transform: scale(1.1);
        box-shadow: 0 0 0 6px rgba(0, 212, 170, 0);
      }

      100% {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 212, 170, 0);
      }
    }

    .settings-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text3);
      font-weight: 700;
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border)
    }

    .settings-card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 12px;
      transition: all .2s
    }

    .settings-card:hover {
      border-color: var(--border2)
    }

    .settings-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px
    }

    .settings-info {
      flex: 1
    }

    .settings-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px
    }

    .settings-desc {
      font-size: 12px;
      color: var(--text3);
      line-height: 1.4
    }

    .theme-switch {
      position: relative;
      width: 56px;
      height: 30px;
      flex-shrink: 0
    }

    .theme-switch input {
      opacity: 0;
      width: 0;
      height: 0
    }

    .theme-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--glass2);
      border: 1px solid var(--border2);
      border-radius: 30px;
      transition: all .35s cubic-bezier(.4, 0, .2, 1)
    }

    .theme-slider::before {
      content: 'üåô';
      position: absolute;
      height: 24px;
      width: 24px;
      left: 3px;
      bottom: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      background: var(--bg2);
      border-radius: 50%;
      transition: all .35s cubic-bezier(.4, 0, .2, 1);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2)
    }

    input:checked+.theme-slider {
      background: var(--emerald-g);
      border-color: var(--emerald)
    }

    input:checked+.theme-slider::before {
      transform: translateX(25px);
      content: '‚òÄÔ∏è';
      background: var(--bg2)
    }

    .theme-preview {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 16px
    }

    .preview-box {
      border-radius: var(--radius-sm);
      padding: 16px;
      text-align: center;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all .2s
    }

    .preview-box:hover {
      border-color: var(--text3)
    }

    .preview-box.active {
      border-color: var(--emerald);
      box-shadow: 0 0 0 2px var(--emerald-g)
    }

    .preview-dark {
      background: #0d1017;
      color: #e8ecf4
    }

    .preview-light {
      background: #ffffff;
      color: #1a1d23
    }

    .preview-label {
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px
    }

    .preview-dots {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-bottom: 6px
    }

    .preview-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%
    }

    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px
    }

    @media(max-width:700px) {
      .settings-grid {
        grid-template-columns: 1fr
      }
    }

    .script-box {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--emerald);
      word-break: break-all;
      position: relative;
      line-height: 1.6
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 10px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--glass);
      color: var(--text3);
      font-size: 10px;
      font-family: 'Outfit';
      cursor: pointer;
      transition: all .2s
    }

    .copy-btn:hover {
      color: var(--emerald);
      border-color: var(--emerald)
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 24px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border)
    }

    .logo {
      font-family: 'JetBrains Mono', monospace;
      font-size: 15px;
      font-weight: 600;
      color: var(--emerald)
    }

    .logo span {
      color: var(--text3);
      font-weight: 400
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--emerald);
      box-shadow: 0 0 8px var(--emerald);
      animation: pulse 2s infinite
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .4
      }
    }

    .version-tag {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      background: var(--emerald-g);
      color: var(--emerald);
      font-weight: 600
    }

    .app-layout {
      display: flex;
      height: 100vh;
      overflow: hidden;
      width: 100%
    }

    .sidebar {
      width: 220px;
      flex-shrink: 0;
      background: var(--bg2);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transition: width .3s ease;
      z-index: 200
    }

    .sidebar.collapsed {
      width: 70px
    }

    .sidebar-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      min-height: 56px
    }

    .sidebar.collapsed .sidebar-header {
      justify-content: center;
      padding: 16px 0
    }

    .sidebar.collapsed .logo {
      display: none
    }

    .sidebar-toggle {
      background: transparent;
      border: none;
      color: var(--text3);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      border-radius: 6px;
      transition: all .2s
    }

    .sidebar-toggle:hover {
      background: var(--glass);
      color: var(--text)
    }

    .sidebar.collapsed .sidebar-toggle svg {
      transform: rotate(180deg)
    }

    .sidebar-nav {
      padding: 16px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 8px;
      color: var(--text3);
      cursor: pointer;
      transition: all .2s;
      font-size: 13px;
      font-weight: 600
    }

    .sidebar-item:hover {
      background: var(--glass2);
      color: var(--text)
    }

    .sidebar-item.active {
      background: var(--emerald-g);
      color: var(--emerald)
    }

    .sidebar.collapsed .sidebar-item {
      justify-content: center;
      padding: 10px 0
    }

    .sidebar.collapsed .sidebar-item span {
      display: none
    }

    .main-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: transparent
    }

    .scroll-area {
      flex: 1;
      overflow-y: auto;
      position: relative
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .mobile-toggle {
      display: none;
      background: transparent;
      border: none;
      color: var(--text);
      cursor: pointer
    }

    @media(max-width:900px) {
      .sidebar {
        position: fixed;
        left: -220px;
        top: 0;
        bottom: 0;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
        transition: left 0.3s ease;
        z-index: 999
      }

      .sidebar.mobile-open {
        left: 0
      }

      .mobile-toggle {
        display: block
      }

      .sidebar.collapsed {
        width: 220px
      }

      .sidebar.collapsed .logo {
        display: block
      }

      .sidebar.collapsed .sidebar-item span {
        display: inline
      }

      .sidebar.collapsed .sidebar-header {
        padding: 16px 20px;
        justify-content: space-between
      }

      .sidebar.collapsed .sidebar-item {
        padding: 10px 14px;
        justify-content: flex-start
      }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1
    }

    .tab-panel {
      display: none
    }

    .tab-panel.active {
      display: block
    }

    .date-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap
    }

    .date-btn {
      padding: 6px 14px;
      border-radius: 20px;
      border: 1px solid var(--border2);
      background: transparent;
      color: var(--text3);
      font-size: 12px;
      font-family: 'Outfit';
      font-weight: 500;
      cursor: pointer;
      transition: all .2s
    }

    .date-btn:hover {
      border-color: var(--text3)
    }

    .date-btn.active {
      background: var(--emerald);
      border-color: var(--emerald);
      color: var(--bg)
    }

    .date-input {
      background: var(--glass2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-sm);
      padding: 6px 12px;
      color: var(--text);
      font-family: 'Outfit';
      font-size: 12px;
      outline: none;
      color-scheme: var(--scheme)
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 12px;
      margin-bottom: 24px
    }

    .stat-card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      position: relative;
      overflow: hidden;
      transition: transform .2s
    }

    .stat-card:hover {
      transform: translateY(-2px)
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px
    }

    .stat-card:nth-child(1)::before {
      background: linear-gradient(90deg, var(--emerald), var(--cyan))
    }

    .stat-card:nth-child(2)::before {
      background: var(--blue)
    }

    .stat-card:nth-child(3)::before {
      background: var(--orange)
    }

    .stat-card:nth-child(4)::before {
      background: var(--purple)
    }

    .stat-card:nth-child(5)::before {
      background: var(--pink)
    }

    .stat-card:nth-child(6)::before {
      background: var(--yellow)
    }

    .stat-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text3);
      margin-bottom: 6px;
      font-weight: 600
    }

    .stat-value {
      font-family: 'JetBrains Mono';
      font-size: 24px;
      font-weight: 700
    }

    .sv1 {
      color: var(--emerald)
    }

    .sv2 {
      color: var(--blue)
    }

    .sv3 {
      color: var(--orange)
    }

    .sv4 {
      color: var(--purple)
    }

    .sv5 {
      color: var(--pink)
    }

    .sv6 {
      color: var(--yellow)
    }

    .stat-sub {
      font-size: 11px;
      color: var(--text3);
      margin-top: 4px
    }

    .charts-row {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      margin-bottom: 16px
    }

    .charts-row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px
    }

    .charts-row-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px
    }

    .chart-panel {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px
    }

    .chart-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 14px
    }

    .panel {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
      gap: 10px
    }

    .filters {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap
    }

    .filter-btn {
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text3);
      font-size: 11px;
      font-family: 'Outfit';
      cursor: pointer;
      font-weight: 500
    }

    .filter-btn.active {
      border-color: var(--emerald);
      color: var(--emerald);
      background: var(--emerald-g)
    }

    .search-input {
      background: var(--glass2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 7px 14px;
      color: var(--text);
      font-size: 12px;
      font-family: 'Outfit';
      outline: none;
      width: 180px
    }

    .btn-danger {
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid var(--red);
      background: var(--red-g);
      color: var(--red);
      font-size: 11px;
      font-family: 'Outfit';
      cursor: pointer;
      font-weight: 600
    }

    .btn-danger:hover {
      background: var(--red);
      color: #fff
    }

    .table-wrap {
      overflow-x: auto
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1100px
    }

    th {
      text-align: left;
      padding: 10px 12px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text3);
      background: var(--glass2);
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      white-space: nowrap
    }

    td {
      padding: 10px 12px;
      font-size: 11px;
      border-bottom: 1px solid var(--border);
      color: var(--text2);
      white-space: nowrap
    }

    tr.lr {
      cursor: pointer;
      transition: background .12s
    }

    tr.lr:hover td {
      background: rgba(255, 255, 255, 0.02)
    }

    .lead-name {
      font-weight: 600;
      color: var(--text);
      font-size: 12px
    }

    .lead-sub {
      font-size: 9px;
      color: var(--text3)
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600
    }

    .b-ig {
      background: rgba(164, 77, 210, 0.15);
      color: #c084fc
    }

    .b-google {
      background: rgba(59, 130, 246, 0.15);
      color: var(--blue)
    }

    .b-direct {
      background: var(--emerald-g);
      color: var(--emerald)
    }

    .b-meta {
      background: rgba(59, 130, 246, 0.12);
      color: #60a5fa
    }

    .b-wa {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80
    }

    .b-other {
      background: var(--orange-g);
      color: var(--orange)
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px
    }

    .st-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%
    }

    .st-converted .st-dot {
      background: var(--emerald)
    }

    .st-converted {
      color: var(--emerald)
    }

    .st-identified .st-dot {
      background: var(--blue)
    }

    .st-identified {
      color: var(--blue)
    }

    .st-returning .st-dot {
      background: var(--orange)
    }

    .st-returning {
      color: var(--orange)
    }

    .st-visiting .st-dot {
      background: var(--text3)
    }

    .st-visiting {
      color: var(--text3)
    }

    .meta-badge {
      font-size: 9px;
      padding: 1px 6px;
      border-radius: 4px;
      background: rgba(59, 130, 246, 0.1);
      color: #60a5fa;
      font-weight: 600
    }

    .act-btns {
      display: flex;
      gap: 4px
    }

    .act-btn {
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: transparent;
      font-size: 10px;
      cursor: pointer;
      font-family: 'Outfit'
    }

    .act-edit {
      color: var(--blue)
    }

    .act-edit:hover {
      background: rgba(59, 130, 246, 0.15)
    }

    .act-del {
      color: var(--red)
    }

    .act-del:hover {
      background: var(--red-g)
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: flex-start;
      padding: 40px;
      overflow-y: auto;
      backdrop-filter: blur(4px)
    }

    .modal-overlay.open {
      display: flex
    }

    .modal {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: 16px;
      width: 100%;
      max-width: 800px;
      animation: slideUp .3s ease
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0
      }

      to {
        transform: translateY(0);
        opacity: 1
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border)
    }

    .modal-close {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text3);
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
      font-family: 'Outfit'
    }

    .modal-body {
      padding: 24px;
      max-height: 70vh;
      overflow-y: auto
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 20px
    }

    .info-box {
      background: var(--glass);
      border-radius: var(--radius-sm);
      padding: 10px;
      border: 1px solid var(--border)
    }

    .info-label {
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: .8px;
      color: var(--text3);
      margin-bottom: 2px;
      font-weight: 600
    }

    .info-val {
      font-family: 'JetBrains Mono';
      font-size: 11px;
      color: var(--text);
      word-break: break-all
    }

    .timeline {
      position: relative;
      padding-left: 24px
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 7px;
      top: 0;
      bottom: 0;
      width: 1.5px;
      background: var(--border)
    }

    .tl-item {
      position: relative;
      margin-bottom: 12px
    }

    .tl-dot {
      position: absolute;
      left: -21px;
      top: 4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 2px solid;
      background: var(--bg)
    }

    .tl-pageview .tl-dot {
      border-color: var(--blue)
    }

    .tl-click .tl-dot {
      border-color: var(--emerald)
    }

    .tl-form_submit .tl-dot,
    .tl-identify .tl-dot {
      border-color: var(--purple)
    }

    .tl-conversion .tl-dot {
      border-color: var(--emerald);
      background: var(--emerald)
    }

    .tl-whatsapp_contact .tl-dot {
      border-color: #4ade80;
      background: #4ade80
    }

    .tl-page_exit .tl-dot {
      border-color: var(--red)
    }

    .tl-content {
      background: var(--glass);
      border-radius: var(--radius-sm);
      padding: 10px 12px;
      border: 1px solid var(--border)
    }

    .tl-time {
      font-family: 'JetBrains Mono';
      font-size: 9px;
      color: var(--text3)
    }

    .tl-event {
      font-size: 12px;
      font-weight: 500
    }

    .tl-detail {
      font-size: 10px;
      color: var(--text3);
      margin-top: 2px
    }

    .edit-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px
    }

    .edit-group {
      display: flex;
      flex-direction: column;
      gap: 4px
    }

    .edit-group label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .8px;
      color: var(--text3);
      font-weight: 600
    }

    .edit-group input,
    .edit-group select {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      color: var(--text);
      font-family: 'Outfit';
      font-size: 13px;
      outline: none
    }

    .edit-group input:focus,
    .edit-group select:focus {
      border-color: var(--emerald)
    }

    .edit-actions {
      grid-column: 1/-1;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 8px
    }

    .btn-save {
      padding: 10px 24px;
      border-radius: 8px;
      border: none;
      background: var(--emerald);
      color: var(--bg);
      font-family: 'Outfit';
      font-size: 13px;
      font-weight: 600;
      cursor: pointer
    }

    .btn-save:hover {
      background: var(--emerald-d)
    }

    .btn-cancel {
      padding: 10px 24px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text3);
      font-family: 'Outfit';
      font-size: 13px;
      cursor: pointer
    }

    .pagination {
      display: flex;
      justify-content: center;
      gap: 6px;
      padding: 14px
    }

    .pg-btn {
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text3);
      font-size: 11px;
      cursor: pointer;
      font-family: 'Outfit'
    }

    .pg-btn.active {
      background: var(--emerald);
      color: var(--bg);
      border-color: var(--emerald)
    }

    .empty {
      text-align: center;
      padding: 48px;
      color: var(--text3)
    }

    .loading {
      text-align: center;
      padding: 32px;
      color: var(--text3)
    }

    @media(max-width:1100px) {
      .stats-grid {
        grid-template-columns: repeat(3, 1fr)
      }

      .charts-row,
      .charts-row-3,
      .charts-row-2 {
        grid-template-columns: 1fr
      }

      .info-grid {
        grid-template-columns: repeat(3, 1fr)
      }
    }

    @media(max-width:700px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr)
      }

      .info-grid {
        grid-template-columns: 1fr 1fr
      }

      .edit-form {
        grid-template-columns: 1fr
      }

      .container {
        padding: 12px
      }
    }

    ::-webkit-scrollbar {
      width: 5px
    }

    ::-webkit-scrollbar-track {
      background: transparent
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px
    }
  </style>
</head>

<body style="margin:0;overflow:hidden;">
  <div class="app-layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">worki<span>/</span>tracker</div>
        <button class="sidebar-toggle" onclick="toggleSidebar()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20"
            style="transition:transform .3s">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7">
            </path>
          </svg>
        </button>
      </div>
      <nav class="sidebar-nav">
        <div class="sidebar-item active" onclick="switchTab('projects')" data-tab="projects">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
          </svg>
          <span>Projetos</span>
        </div>
        <div class="sidebar-item" onclick="switchTab('hub')" data-tab="hub">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
            </path>
          </svg>
          <span>Hub</span>
        </div>
        <div class="sidebar-item" onclick="switchTab('leads')" data-tab="leads">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M17 20h5V10a2 2 0 00-2-2h-3M9 20H4a2 2 0 01-2-2V10a2 2 0 012-2h5m4 12V8a2 2 0 00-2-2h-4a2 2 0 00-2 2v12m8 0h-8M9 4h6m-3-1v2">
            </path>
          </svg>
          <span>Leads</span>
        </div>
        <div class="sidebar-item" onclick="switchTab('settings')" data-tab="settings">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
            </path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
            </path>
          </svg>
          <span>Configura√ß√µes</span>
        </div>
      </nav>
    </aside>
    <div class="main-wrapper">
      <div class="topbar">
        <div class="topbar-left">
          <button class="mobile-toggle" onclick="toggleMobileSidebar()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        <div class="topbar-right"><select id="globalProjectSelector" onchange="changeGlobalProject(this.value)"
            style="background:var(--glass2);border:1px solid var(--border);color:var(--text);border-radius:6px;padding:4px 8px;font-family:'Outfit';font-size:12px;outline:none;margin-right:12px">
            <option value="all">Todos os Projetos</option>
          </select>
          <div class="realtime-widget" id="realtimeWidget"
            style="display:flex;align-items:center;background:var(--emerald-g);padding:4px 12px;border-radius:20px;border:1px solid rgba(0,212,170,0.3);font-size:12px;color:var(--emerald);font-weight:700;gap:8px;margin-right:12px;">
            <div class="live-indicator"
              style="width:8px;height:8px;background:var(--emerald);border-radius:50%;animation:pulse-live 2s infinite;">
            </div>
            <span id="realtimeCount">...</span> online agora
          </div>
          <span class="version-tag">v3.0</span>
        </div>
      </div>
      <div class="scroll-area">
        <div class="container">
          <!-- HUB -->
          <div class="tab-panel active" id="panel-hub">
            <div class="date-bar"><button class="date-btn" data-days="0" onclick="setPreset(this)">Hoje</button><button
                class="date-btn" data-days="1" onclick="setPreset(this)">Ontem</button><button class="date-btn active"
                data-days="7" onclick="setPreset(this)">7 dias</button><button class="date-btn" data-days="15"
                onclick="setPreset(this)">15 dias</button><button class="date-btn" data-days="30"
                onclick="setPreset(this)">30 dias</button><span
                style="color:var(--text3);font-size:11px;margin-left:8px">|</span><input type="date" class="date-input"
                id="df" onchange="customDate()"><span style="color:var(--text3);font-size:11px">at√©</span><input
                type="date" class="date-input" id="dt" onchange="customDate()"></div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label">Visitantes</div>
                <div class="stat-value sv1" id="s1">‚Äî</div>
                <div class="stat-sub" id="s1s"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Identificados</div>
                <div class="stat-value sv2" id="s2">‚Äî</div>
                <div class="stat-sub" id="s2s"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Convers√µes</div>
                <div class="stat-value sv3" id="s3">‚Äî</div>
                <div class="stat-sub" id="s3s"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Faturamento</div>
                <div class="stat-value sv4" id="s4">‚Äî</div>
                <div class="stat-sub" id="s4s"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Instagram</div>
                <div class="stat-value sv5" id="s5">‚Äî</div>
                <div class="stat-sub" id="s5s"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Meta Ads</div>
                <div class="stat-value sv6" id="s6">‚Äî</div>
                <div class="stat-sub" id="s6s"></div>
              </div>
            </div>
            <div class="charts-row">
              <div class="chart-panel">
                <div class="chart-title">üìà Crescimento</div><canvas id="cGrowth" height="180"></canvas>
              </div>
              <div class="chart-panel">
                <div class="chart-title">üîª Funil de Vendas</div><canvas id="cFunnel" height="180"></canvas>
              </div>
            </div>
            <div class="charts-row-3">
              <div class="chart-panel">
                <div class="chart-title">üì± Dispositivos</div><canvas id="cDevices" height="180"></canvas>
              </div>
              <div class="chart-panel">
                <div class="chart-title">üèôÔ∏è Cidades</div><canvas id="cCities" height="180"></canvas>
              </div>
              <div class="chart-panel">
                <div class="chart-title">üó∫Ô∏è Estados</div><canvas id="cStates" height="180"></canvas>
              </div>
            </div>
            <div class="charts-row-2">
              <div class="chart-panel">
                <div class="chart-title">üîó Origens</div><canvas id="cSources" height="180"></canvas>
              </div>
              <div class="chart-panel" style="display:flex;flex-direction:column">
                <div class="chart-title">üìä Resumo do Per√≠odo</div>
                <div id="summaryBox" style="flex:1;display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>
              </div>
            </div>

            <div class="panel" style="margin-bottom: 24px;">
              <div class="panel-header">
                <h2>üéØ Performance por Campanha</h2>
              </div>
              <div class="table-wrap">
                <table style="min-width: 800px">
                  <thead>
                    <tr>
                      <th>Campanha (UTM)</th>
                      <th>Cliques / Visitors</th>
                      <th>Leads</th>
                      <th>Convers√µes</th>
                      <th>Receita</th>
                    </tr>
                  </thead>
                  <tbody id="tbCampaigns">
                    <tr>
                      <td colspan="5" class="loading">Carregando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- LEADS -->
          <div class="tab-panel" id="panel-leads">
            <div class="panel">
              <div class="panel-header">
                <h2>Explorador de Leads</h2>
                <div class="filters"><button class="filter-btn active" data-st="all"
                    onclick="filterSt(this)">Todos</button><button class="filter-btn" data-st="visiting"
                    onclick="filterSt(this)">Visitando</button><button class="filter-btn" data-st="identified"
                    onclick="filterSt(this)">Identificados</button><button class="filter-btn" data-st="converted"
                    onclick="filterSt(this)">Convertidos</button><input type="text" class="search-input"
                    placeholder="Buscar..." oninput="searchLeads(this.value)">
                  <button class="btn-save" style="padding:5px 12px;font-size:11px;" onclick="exportCSV()">üì• Exportar
                    CSV</button>
                  <button class="btn-danger" onclick="deleteAllLeads()">üóë Excluir Todos</button>
                </div>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Lead</th>
                      <th>Temp.</th>
                      <th>Entrada</th>
                      <th>Contato</th>
                      <th>Cidade</th>
                      <th>Estado</th>
                      <th>Dispositivo</th>
                      <th>Origem</th>
                      <th>Meta</th>
                      <th>√öltima Atividade</th>
                      <th>Status</th>
                      <th>A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="tbody">
                    <tr>
                      <td colspan="11" class="loading">Carregando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="pag"></div>
            </div>
          </div>
          <!-- PROJECTS -->
          <div class="tab-panel" id="panel-projects">
            <div class="panel" style="margin-bottom:20px">
              <div class="panel-header">
                <h2>Gerenciar Projetos</h2><button class="btn-save" style="padding:6px 14px"
                  onclick="openProjectModal()">+ Novo Projeto</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nome do Projeto</th>
                      <th>FB Pixel ID</th>
                      <th>Access Token</th>
                      <th>Criado em</th>
                      <th>A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="projectsBody">
                    <tr>
                      <td colspan="6" class="loading">Carregando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- SETTINGS -->
          <div class="tab-panel" id="panel-settings">
            <div class="settings-grid">
              <div>
                <div class="settings-section">
                  <div class="settings-title">üé® Apar√™ncia</div>
                  <div class="settings-card">
                    <div class="settings-row">
                      <div class="settings-info">
                        <div class="settings-label">Modo de Cores</div>
                        <div class="settings-desc">Alterne entre tema escuro para noite e claro para o dia</div>
                      </div>
                      <label class="theme-switch"><input type="checkbox" id="themeToggle"
                          onchange="toggleTheme(this.checked)"><span class="theme-slider"></span></label>
                    </div>
                    <div class="theme-preview">
                      <div class="preview-box preview-dark active" id="prevDark" onclick="setTheme('dark')">
                        <div class="preview-dots">
                          <div class="preview-dot" style="background:#00d4aa"></div>
                          <div class="preview-dot" style="background:#3b82f6"></div>
                          <div class="preview-dot" style="background:#a78bfa"></div>
                        </div>
                        <div class="preview-label">üåô Escuro</div>
                      </div>
                      <div class="preview-box preview-light" id="prevLight" onclick="setTheme('light')">
                        <div class="preview-dots">
                          <div class="preview-dot" style="background:#00b894"></div>
                          <div class="preview-dot" style="background:#2563eb"></div>
                          <div class="preview-dot" style="background:#7c3aed"></div>
                        </div>
                        <div class="preview-label">‚òÄÔ∏è Claro</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="settings-section">
                  <div class="settings-title">üîë Acesso</div>
                  <div class="settings-card">
                    <div class="settings-row">
                      <div class="settings-info">
                        <div class="settings-label">API Key</div>
                        <div class="settings-desc">Chave de autentica√ß√£o do dashboard</div>
                      </div>
                      <button class="filter-btn" onclick="changeApiKey()" style="padding:8px 16px">Alterar</button>
                    </div>
                  </div>
                </div>
              </div>

              <div>
                <div class="settings-section">
                  <div class="settings-title">üì¶ Script de Rastreamento</div>
                  <div class="settings-card">
                    <div class="settings-info" style="margin-bottom:12px">
                      <div class="settings-label">Instale na sua landing page</div>
                      <div class="settings-desc">Cole no &lt;head&gt; da p√°gina para ativar o tracking completo</div>
                    </div>
                    <div class="script-box" id="scriptBox">
                      <button class="copy-btn" onclick="copyScript()">Copiar</button>
                      &lt;!-- Meta Pixel --&gt;<br>
                      &lt;script&gt;<br>
                      !function(f,b,e,v,n,t,s){...}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');<br>
                      fbq('init','990028642721674');<br>
                      &lt;/script&gt;<br><br>
                      &lt;!-- Worki Tracker --&gt;<br>
                      &lt;script src="https://tracker.workidigital.tech/public/wk.js" async&gt;&lt;/script&gt;
                    </div>
                  </div>
                </div>

                <div class="settings-section">
                  <div class="settings-title">‚ÑπÔ∏è Sistema</div>
                  <div class="settings-card">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                      <div>
                        <div class="settings-desc">Vers√£o</div>
                        <div class="settings-label">Worki Tracker v2.6</div>
                      </div>
                      <div>
                        <div class="settings-desc">Script</div>
                        <div class="settings-label">wk.js v3.3</div>
                      </div>
                      <div>
                        <div class="settings-desc">Meta CAPI</div>
                        <div class="settings-label" style="color:var(--emerald)">‚úÖ Ativo</div>
                      </div>
                      <div>
                        <div class="settings-desc">Pixel ID</div>
                        <div class="settings-label">990028642721674</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- .container -->
    </div> <!-- .scroll-area -->
  </div> <!-- .main-wrapper -->
  </div> <!-- .app-layout -->
  <div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <div class="modal-header">
        <h2 id="mtitle">Jornada</h2><button class="modal-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modal-body" id="mbody"></div>
    </div>
  </div>
  <!-- MODAL EDITAR -->
  <div class="modal-overlay" id="editModal" onclick="if(event.target===this)closeEdit()">
    <div class="modal">
      <div class="modal-header">
        <h2>Editar Lead</h2><button class="modal-close" onclick="closeEdit()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="edit-form">
          <div class="edit-group"><label>Nome</label><input id="ed-name"></div>
          <div class="edit-group"><label>Email</label><input id="ed-email"></div>
          <div class="edit-group"><label>Telefone</label><input id="ed-phone"></div>
          <div class="edit-group"><label>Instagram</label><input id="ed-instagram"></div>
          <div class="edit-group"><label>Empresa</label><input id="ed-empresa"></div>
          <div class="edit-group"><label>Cidade</label><input id="ed-city"></div>
          <div class="edit-group"><label>Estado</label><input id="ed-state"></div>
          <div class="edit-group"><label>Status</label><select id="ed-status">
              <option value="visiting">Visitando</option>
              <option value="returning">Retornando</option>
              <option value="identified">Identificado</option>
              <option value="converted">Convertido</option>
            </select></div>
          <div class="edit-actions"><button class="btn-cancel" onclick="closeEdit()">Cancelar</button><button
              class="btn-save" onclick="saveEdit()">Salvar</button></div>
        </div>
      </div>
    </div>
  </div>
  <!-- MODAL PROJETOS -->
  <div class="modal-overlay" id="projectModal" onclick="if(event.target===this)closeProjectModal()">
    <div class="modal" style="max-width:500px">
      <div class="modal-header">
        <h2 id="projModalTitle">Novo Projeto</h2><button class="modal-close" onclick="closeProjectModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="edit-form" style="grid-template-columns:1fr"><input type="hidden" id="projId">
          <div class="edit-group"><label>Nome do Projeto</label><input id="projName" placeholder="Ex: Lan√ßamento XYZ">
          </div>
          <div class="edit-group"><label>Meta Pixel ID</label><input id="projPixel" placeholder="Somente n√∫meros"></div>
          <div class="edit-group"><label>Meta Access Token (CAPI)</label><input type="password" id="projToken"
              placeholder="EAA...">
          </div>
          <div class="edit-actions"><button class="btn-cancel" onclick="closeProjectModal()">Cancelar</button><button
              class="btn-save" onclick="saveProject()">Salvar</button></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚ïê‚ïê‚ïê THEME ‚ïê‚ïê‚ïê
    function setTheme(t) { document.documentElement.setAttribute('data-theme', t); localStorage.setItem('wk_theme', t); document.getElementById('themeToggle').checked = t === 'light'; document.getElementById('prevDark').classList.toggle('active', t === 'dark'); document.getElementById('prevLight').classList.toggle('active', t === 'light'); updateChartColors(); if (document.getElementById('df')) document.getElementById('df').style.colorScheme = t; if (document.getElementById('dt')) document.getElementById('dt').style.colorScheme = t }
    function toggleTheme(isLight) { setTheme(isLight ? 'light' : 'dark') }
    function changeApiKey() { var k = prompt('Nova API Key:') || ''; if (k) { localStorage.setItem('wk_key', k); API_KEY = k; H['X-API-Key'] = k; loadAll() } }
    function copyScript() {
      var p = projectsData.find(function (x) { return x.id == curProject });
      if (!p) p = projectsData[0];
      var pix = p ? p.fb_pixel_id : '[SEU_PIXEL_ID]';
      var pid = p ? p.id : '1';
      var t = '<!-- Meta Pixel -->\n<script>\n!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version=\'2.0\';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,\'script\',\'https://connect.facebook.net/en_US/fbevents.js\');\nfbq(\'init\',\'' + pix + '\');\n<\\/script>\n\n<!-- Worki Tracker -->\n<script src="https://tracker.workidigital.tech/public/wk.js" data-project="' + pid + '" async><\\/script>';
      navigator.clipboard.writeText(t).then(function () {
        var b = document.querySelector('.copy-btn');
        b.textContent = '‚úÖ Copiado!';
        setTimeout(function () { b.textContent = 'Copiar' }, 2000);
      });
    }
    function updateChartColors() { var isDark = !document.documentElement.getAttribute('data-theme') || document.documentElement.getAttribute('data-theme') === 'dark'; Chart.defaults.color = isDark ? '#8b95a8' : '#4a5568'; Chart.defaults.borderColor = isDark ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.06)'; loadCharts() }
    (function () { var saved = localStorage.getItem('wk_theme'); if (saved) setTheme(saved) })();

    var BASE = window.location.origin + '/api/dashboard';
    var API_KEY = localStorage.getItem('wk_key') || '';
    if (!API_KEY) { API_KEY = prompt('API Key:') || ''; localStorage.setItem('wk_key', API_KEY) }
    var H = { 'X-API-Key': API_KEY, 'Content-Type': 'application/json' };
    var curPage = 1, curStatus = 'all', searchQ = '', searchT = null, dateFrom = '', dateTo = '', charts = {}, editingVid = '';
    var curProject = 'all', projectsData = [];

    async function api(p, opt) { opt = opt || {}; var r = await fetch(BASE + p, { headers: Object.assign({}, H, opt.headers || {}), method: opt.method || 'GET', body: opt.body ? JSON.stringify(opt.body) : undefined }); if (!r.ok && r.status === 401) { localStorage.removeItem('wk_key'); API_KEY = prompt('API Key inv√°lida:') || ''; localStorage.setItem('wk_key', API_KEY); H['X-API-Key'] = API_KEY; return api(p, opt) } if (!r.ok) throw new Error(r.status); return r.json() }
    function fmt(n) { return Number(n || 0).toLocaleString('pt-BR') }
    function fmtR(n) { return 'R$ ' + Number(n || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 }) }
    function fmtDT(d) { if (!d) return '‚Äî'; var dt = new Date(d); return dt.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }) + ' ' + dt.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) }
    function esc(s) { var d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML }
    function dp() { var p = ''; if (dateFrom) p += '&date_from=' + dateFrom; if (dateTo) p += '&date_to=' + dateTo; if (curProject !== 'all') p += '&project_id=' + curProject; return p }

    function switchTab(t) { document.querySelectorAll('.sidebar-item').forEach(function (b) { b.classList.remove('active') }); document.querySelectorAll('.tab-panel').forEach(function (p) { p.classList.remove('active') }); var act = document.querySelector('.sidebar-item[data-tab="' + t + '"]'); if (act) act.classList.add('active'); var pan = document.getElementById('panel-' + t); if (pan) pan.classList.add('active'); if (t === 'leads') loadLeads(); if (window.innerWidth <= 900) document.getElementById('sidebar').classList.remove('mobile-open') }
    function toggleSidebar() { var sb = document.getElementById('sidebar'); sb.classList.toggle('collapsed'); localStorage.setItem('wk_sidebar', sb.classList.contains('collapsed') ? '1' : '0') }
    function toggleMobileSidebar() { document.getElementById('sidebar').classList.toggle('mobile-open') }
    function setPreset(btn) { document.querySelectorAll('.date-btn').forEach(function (b) { b.classList.remove('active') }); btn.classList.add('active'); var d = parseInt(btn.dataset.days), t = new Date(); if (d === 0) dateFrom = dateTo = t.toISOString().split('T')[0]; else if (d === 1) { var y = new Date(t - 864e5); dateFrom = dateTo = y.toISOString().split('T')[0] } else { dateTo = t.toISOString().split('T')[0]; dateFrom = new Date(t - d * 864e5).toISOString().split('T')[0] } document.getElementById('df').value = dateFrom; document.getElementById('dt').value = dateTo; loadAll() }
    function customDate() { document.querySelectorAll('.date-btn').forEach(function (b) { b.classList.remove('active') }); dateFrom = document.getElementById('df').value; dateTo = document.getElementById('dt').value; loadAll() }

    // ‚ïê‚ïê‚ïê STATS ‚ïê‚ïê‚ïê
    async function loadStats() { try { var p = new URLSearchParams(); if (dateFrom) p.set('date_from', dateFrom); if (dateTo) p.set('date_to', dateTo); if (curProject !== 'all') p.set('project_id', curProject); var d = await api('/stats?' + p); document.getElementById('s1').innerText = fmt(d.total_visitors); document.getElementById('s1s').innerHTML = '<span class="trend up">+' + fmt(d.active_7d) + ' ativos (7d)</span>'; document.getElementById('s2').innerText = fmt(d.identified_leads); document.getElementById('s2s').innerText = 'Contatos salvos'; document.getElementById('s3').innerText = fmt(d.conversions); document.getElementById('s3s').innerHTML = '<span class="trend up">' + d.conversion_rate + '% tb. conv.</span>'; document.getElementById('s4').innerText = fmtR(d.total_revenue); document.getElementById('s4s').innerText = d.avg_days_to_convert + ' dias p/ compra'; document.getElementById('s5').innerText = fmt(d.instagram_leads); document.getElementById('s5s').innerText = 'Arrobas capturados'; document.getElementById('s6').innerText = fmt(d.meta_leads); document.getElementById('s6s').innerText = 'Tr√°fego pago (CAPI)' } catch (e) { document.getElementById('s1').innerText = 'ERRO'; document.getElementById('s1s').innerText = 'API Key Inv√°lida ou Falha' } }

    async function loadRealtime() {
      try {
        var p = new URLSearchParams();
        if (curProject !== 'all') p.set('project_id', curProject);
        var res = await api('/realtime?' + p);
        if (res && res.active !== undefined) {
          document.getElementById('realtimeCount').innerText = res.active;
        }
      } catch (e) { console.error('Realtime erro:', e); }
    }

    setInterval(loadRealtime, 10000); // Atualiza a cada 10 segundos

    // ‚ïê‚ïê‚ïê CHARTS ‚ïê‚ïê‚ïê
    var CL = { emerald: '#00d4aa', cyan: '#22d3ee', blue: '#3b82f6', purple: '#a78bfa', pink: '#f472b6', orange: '#fb923c', yellow: '#fbbf24' };
    Chart.defaults.color = '#8b95a8'; Chart.defaults.borderColor = 'rgba(255,255,255,0.04)'; Chart.defaults.font.family = 'Outfit'; Chart.defaults.font.size = 11;
    function dc(id) { if (charts[id]) { charts[id].destroy(); delete charts[id] } }

    async function loadCharts() {
      try {
        var d = await api('/charts?' + dp().replace('&', ''));
        dc('g'); charts.g = new Chart(document.getElementById('cGrowth'), { type: 'line', data: { labels: d.daily.map(function (r) { return new Date(r.day).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }) }), datasets: [{ label: 'Visitantes', data: d.daily.map(function (r) { return r.visitors }), borderColor: CL.emerald, backgroundColor: 'rgba(0,212,170,0.08)', fill: true, tension: .4, pointRadius: 0, borderWidth: 2 }, { label: 'Pageviews', data: d.daily.map(function (r) { return r.pageviews }), borderColor: CL.blue, tension: .4, pointRadius: 0, borderWidth: 1.5, borderDash: [4, 4] }, { label: 'Convers√µes', data: d.daily.map(function (r) { return r.conversions }), borderColor: CL.orange, tension: .4, pointRadius: 0, borderWidth: 1.5 }] }, options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, padding: 12 } } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, x: { grid: { display: false } } } } });
        dc('f'); var f = d.funnel; charts.f = new Chart(document.getElementById('cFunnel'), { type: 'bar', data: { labels: ['Visitantes', 'Engajados', 'Identificados', 'WhatsApp', 'Convertidos'], datasets: [{ data: [f.total, f.engaged, f.identified, f.whatsapp, f.converted], backgroundColor: [CL.emerald + '99', CL.cyan + '99', CL.blue + '99', CL.purple + '99', CL.orange + '99'], borderRadius: 6, barPercentage: .7 }] }, options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, y: { grid: { display: false } } } } });
        dc('dv'); charts.dv = new Chart(document.getElementById('cDevices'), { type: 'doughnut', data: { labels: d.devices.map(function (r) { return r.device }), datasets: [{ data: d.devices.map(function (r) { return r.count }), backgroundColor: [CL.emerald, CL.blue, CL.purple, CL.orange, CL.pink], borderWidth: 0 }] }, options: { responsive: true, cutout: '65%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 10 } } } } });
        var cities = d.cities || []; dc('ci'); charts.ci = new Chart(document.getElementById('cCities'), { type: 'bar', data: { labels: cities.map(function (r) { return r.city }), datasets: [{ data: cities.map(function (r) { return r.count }), backgroundColor: CL.cyan + '99', borderRadius: 4 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, x: { grid: { display: false } } } } });
        var states = d.states || []; dc('st'); charts.st = new Chart(document.getElementById('cStates'), { type: 'bar', data: { labels: states.map(function (r) { return r.state }), datasets: [{ data: states.map(function (r) { return r.count }), backgroundColor: CL.purple + '99', borderRadius: 4 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, x: { grid: { display: false } } } } });
        dc('sr'); charts.sr = new Chart(document.getElementById('cSources'), { type: 'bar', data: { labels: d.sources.map(function (r) { return r.source }), datasets: [{ label: 'Visitantes', data: d.sources.map(function (r) { return r.visitors }), backgroundColor: CL.blue + '99', borderRadius: 4 }, { label: 'Convers√µes', data: d.sources.map(function (r) { return r.conversions }), backgroundColor: CL.emerald + '99', borderRadius: 4 }] }, options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10 } } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, x: { grid: { display: false } } } } });
        var sb = document.getElementById('summaryBox'); var tc = cities[0] ? cities[0].city : '‚Äî'; var ts = states[0] ? states[0].state : '‚Äî'; var to = d.sources[0] ? d.sources[0].source : '‚Äî'; var td = d.devices[0] ? d.devices[0].device : '‚Äî';
        sb.innerHTML = '<div class="info-box"><div class="info-label">Top Cidade</div><div class="info-val">' + esc(tc) + '</div></div><div class="info-box"><div class="info-label">Top Estado</div><div class="info-val">' + esc(ts) + '</div></div><div class="info-box"><div class="info-label">Top Origem</div><div class="info-val">' + esc(to) + '</div></div><div class="info-box"><div class="info-label">Top Dispositivo</div><div class="info-val">' + esc(td) + '</div></div>';

        var cp = document.getElementById('tbCampaigns');
        if (cp && d.campaigns) {
          if (!d.campaigns.length) cp.innerHTML = '<tr><td colspan="5" class="empty">Nenhuma campanha registrada</td></tr>';
          else cp.innerHTML = d.campaigns.map(function (c) {
            return '<tr class="lr"><td><strong>' + esc(c.campaign) + '</strong></td><td>' + fmt(c.visitors) + '</td><td>' + fmt(c.leads) + '</td><td>' + fmt(c.conversions) + '</td><td style="color:var(--emerald);font-weight:600">' + fmtR(c.revenue) + '</td></tr>';
          }).join('');
        }
      } catch (e) { console.error('Charts:', e) }
    }

    // ‚ïê‚ïê‚ïê LEADS TABLE ‚ïê‚ïê‚ïê
    async function loadLeads() { try { var p = new URLSearchParams({ page: curPage, limit: 25 }); if (curStatus !== 'all') p.set('status', curStatus); if (curProject !== 'all') p.set('project_id', curProject); if (searchQ) p.set('search', searchQ); if (dateFrom) p.set('date_from', dateFrom); if (dateTo) p.set('date_to', dateTo); var d = await api('/leads?' + p); renderLeads(d.leads); renderPag(d.total, d.page, d.limit) } catch (e) { document.getElementById('tbody').innerHTML = '<tr><td colspan="11" class="empty">Erro. Verifique API Key.</td></tr>' } }

    function renderLeads(leads) {
      var tb = document.getElementById('tbody'); if (!leads.length) { tb.innerHTML = '<tr><td colspan="12" class="empty">Nenhum lead</td></tr>'; return }
      tb.innerHTML = leads.map(function (l) {
        var nm = l.name || l.visitor_id.substring(0, 12) + '‚Ä¶';
        var sc = getSrc(l.first_utm_source);
        var stC = 'st-' + (l.status || 'visiting');
        var stL = { converted: 'Converteu', identified: 'Identificado', returning: 'Retornando', visiting: 'Visitando' }[l.status] || l.status;
        var ct = [l.email, l.instagram ? '@' + l.instagram : ''].filter(Boolean).join(' ¬∑ ') || l.phone || '‚Äî';
        var hm = (l.fbclid || l.fbc) ? '<span class="meta-badge">META</span>' : '';
        var act = [(l.total_pageviews || 0) + ' pgs', l.whatsapp_contacted ? 'üí¨ WA' : ''].filter(Boolean).join(' ¬∑ ');

        var tempBadge = '';
        if (l.temperature === 'hot') tempBadge = 'üî• Quente';
        else if (l.temperature === 'warm') tempBadge = '‚òÄÔ∏è Morno';
        else tempBadge = '‚ùÑÔ∏è Frio';

        return '<tr class="lr" onclick="openJourney(\'' + l.visitor_id + '\')">'
          + '<td><div class="lead-name">' + esc(nm) + '</div></td>'
          + '<td><span class="badge" style="background:var(--glass2)">' + tempBadge + '</span></td>'
          + '<td>' + fmtDT(l.first_seen) + '</td>'
          + '<td style="font-size:10px">' + esc(ct) + '</td>'
          + '<td style="font-size:10px">' + esc(l.city || '‚Äî') + '</td>'
          + '<td style="font-size:10px">' + esc(l.state || '‚Äî') + '</td>'
          + '<td style="font-size:10px">' + esc(l.device_type || '‚Äî') + '</td>'
          + '<td><span class="badge ' + sc + '">' + esc(l.first_utm_source || 'direto') + '</span></td>'
          + '<td>' + hm + '</td>'
          + '<td><div style="font-size:10px">' + fmtDT(l.last_seen) + '</div><div class="lead-sub">' + act + '</div></td>'
          + '<td><span class="status-badge ' + stC + '"><span class="st-dot"></span>' + stL + '</span></td>'
          + '<td><div class="act-btns"><button class="act-btn act-edit" onclick="event.stopPropagation();openEdit(\'' + l.visitor_id + '\')">‚úèÔ∏è</button><button class="act-btn act-del" onclick="event.stopPropagation();deleteLead(\'' + l.visitor_id + '\',\'' + esc(nm).replace(/\'/g, "\\'") + '\')">üóë</button></div></td>'
          + '</tr>'
      }).join('')
    }

    async function exportCSV() {
      try {
        var p = new URLSearchParams({ page: 1, limit: 10000 });
        if (curStatus !== 'all') p.set('status', curStatus);
        if (curProject !== 'all') p.set('project_id', curProject);
        if (searchQ) p.set('search', searchQ);
        if (dateFrom) p.set('date_from', dateFrom);
        if (dateTo) p.set('date_to', dateTo);
        var res = await api('/leads?' + p);
        var csv = 'ID,Nome,Email,Telefone,Instagram,Temperatura,Status,Score,Origem,Campanha,Cidade,Estado,Data\n';
        res.leads.forEach(function (l) {
          csv += '"' + l.visitor_id + '","' + (l.name || '') + '","' + (l.email || '') + '","' + (l.phone || '') + '","' + (l.instagram || '') + '","' + (l.temperature || '') + '","' + (l.status || '') + '","' + (l.score || 0) + '","' + (l.first_utm_source || '') + '","' + (l.first_utm_campaign || '') + '","' + (l.city || '') + '","' + (l.state || '') + '","' + l.first_seen + '"\n';
        });
        var blob = new Blob([csv], { type: 'text/csv' });
        var url = window.URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'leads_track.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) { alert('Erro ao exportar CSV'); }
    }

    function renderPag(t, p, l) { var pg = Math.ceil(t / l), el = document.getElementById('pag'); if (pg <= 1) { el.innerHTML = ''; return } var h = ''; for (var i = 1; i <= Math.min(pg, 10); i++)h += '<button class="pg-btn ' + (i === p ? 'active' : '') + '" onclick="goPage(' + i + ')">' + i + '</button>'; el.innerHTML = h }
    function getSrc(s) { if (!s) return 'b-direct'; var l = s.toLowerCase(); if (l.includes('instagram')) return 'b-ig'; if (l.includes('google')) return 'b-google'; if (l.includes('whatsapp')) return 'b-wa'; if (l.includes('facebook') || l.includes('meta')) return 'b-meta'; return 'b-other' }
    function filterSt(btn) { document.querySelectorAll('.filter-btn').forEach(function (b) { b.classList.remove('active') }); btn.classList.add('active'); curStatus = btn.dataset.st; curPage = 1; loadLeads() }
    function searchLeads(q) { clearTimeout(searchT); searchT = setTimeout(function () { searchQ = q; curPage = 1; loadLeads() }, 300) }
    function goPage(p) { curPage = p; loadLeads() }

    // ‚ïê‚ïê‚ïê JORNADA MODAL ‚Äî com TODOS os campos ‚ïê‚ïê‚ïê
    async function openJourney(vid) {
      document.getElementById('modal').classList.add('open'); document.getElementById('mbody').innerHTML = '<div class="loading">Carregando...</div>';
      try {
        var j = await api('/leads/' + encodeURIComponent(vid) + '/journey'); var v = j.visitor;
        document.getElementById('mtitle').textContent = v.name || v.visitor_id;
        var h = '<div class="info-grid">';
        h += '<div class="info-box"><div class="info-label">Telefone</div><div class="info-val">' + (v.phone || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Email</div><div class="info-val">' + (v.email || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Instagram</div><div class="info-val">' + (v.instagram ? '@' + v.instagram : '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Empresa</div><div class="info-val">' + (v.empresa || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Cidade</div><div class="info-val">' + (v.city || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Estado</div><div class="info-val">' + (v.state || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">CEP</div><div class="info-val">' + (v.zip_code || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Pa√≠s</div><div class="info-val">' + (v.country || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Dispositivo</div><div class="info-val">' + (v.device_type || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">OS / Browser</div><div class="info-val">' + ([v.device_os, v.device_browser].filter(Boolean).join(' / ') || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Tela</div><div class="info-val">' + (v.device_screen || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">IP</div><div class="info-val">' + (v.client_ip || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Origem</div><div class="info-val">' + (v.first_utm_source || 'direto') + (v.first_utm_campaign ? ' (' + v.first_utm_campaign + ')' : '') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">FBCLID</div><div class="info-val">' + (v.fbclid ? v.fbclid.substring(0, 24) + '‚Ä¶' : '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">FBP</div><div class="info-val">' + (v.fbp || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">FBC</div><div class="info-val">' + (v.fbc || '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Visitas</div><div class="info-val">' + v.total_visits + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Pageviews</div><div class="info-val">' + (v.total_pageviews || 0) + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Convers√£o</div><div class="info-val">' + (v.converted ? fmtR(v.conversion_value) : '‚Äî') + '</div></div>';
        h += '<div class="info-box"><div class="info-label">Dias p/ Converter</div><div class="info-val">' + (v.days_to_convert != null ? v.days_to_convert : '‚Äî') + '</div></div>';
        h += '</div>';
        var evts = j.events.filter(function (e) { return e.event_type !== 'heartbeat' });
        h += '<div class="timeline">'; evts.forEach(function (e) { var d = typeof e.data === 'string' ? JSON.parse(e.data) : (e.data || {}); var r = fmtEvt(e.event_type, d, e.page); h += '<div class="tl-item tl-' + e.event_type + '"><div class="tl-dot"></div><div class="tl-content"><div class="tl-time">' + fmtDT(e.created_at) + '</div><div class="tl-event">' + r.label + '</div>' + (r.detail ? '<div class="tl-detail">' + r.detail + '</div>' : '') + '</div></div>' }); h += '</div>';
        document.getElementById('mbody').innerHTML = h
      } catch (e) { document.getElementById('mbody').innerHTML = '<div class="empty">Erro ao carregar</div>' }
    }
    function closeModal() { document.getElementById('modal').classList.remove('open') }

    function fmtEvt(type, d, page) { switch (type) { case 'pageview': return { label: 'Visitou ' + (page || '/'), detail: d.utm && d.utm.source ? 'Via ' + d.utm.source + (d.utm.campaign ? ' (' + d.utm.campaign + ')' : '') : d.referrer ? 'Ref: ' + d.referrer : 'Direto' }; case 'click': if (d.type === 'whatsapp_click') return { label: 'üì± WhatsApp', detail: d.phone }; if (d.type === 'phone_click') return { label: 'üìû Telefone', detail: d.phone }; return { label: 'Clique: ' + (d.text || d.id || d.tag || 'link'), detail: d.href || '' }; case 'scroll': return { label: 'Scroll ' + d.depth, detail: '' }; case 'form_submit': return { label: 'üìù Formul√°rio', detail: Object.entries(d.fields || {}).map(function (e) { return e[0] + ': ' + e[1] }).join(', ') }; case 'identify': return { label: 'üè∑Ô∏è Identificado', detail: ((d.name || '') + ' ' + (d.email || '') + ' ' + (d.phone || '')).trim() }; case 'conversion': return { label: 'üéØ CONVERS√ÉO' + (d.source ? ' ‚Äî ' + d.source : ''), detail: d.value ? fmtR(d.value) + (d.product ? ' ‚Äî ' + d.product : '') : '' }; case 'whatsapp_contact': return { label: 'üí¨ WhatsApp', detail: (d.pushName || '') + ': "' + (d.message || '').substring(0, 80) + '"' }; case 'page_exit': return { label: 'üö™ Saiu', detail: (d.time_on_page || 0) + 's' }; default: return { label: type, detail: '' } } }

    // ‚ïê‚ïê‚ïê EDITAR ‚ïê‚ïê‚ïê
    async function openEdit(vid) { editingVid = vid; try { var j = await api('/leads/' + encodeURIComponent(vid) + '/journey'); var v = j.visitor; document.getElementById('ed-name').value = v.name || ''; document.getElementById('ed-email').value = v.email || ''; document.getElementById('ed-phone').value = v.phone || ''; document.getElementById('ed-instagram').value = v.instagram || ''; document.getElementById('ed-empresa').value = v.empresa || ''; document.getElementById('ed-city').value = v.city || ''; document.getElementById('ed-state').value = v.state || ''; document.getElementById('ed-status').value = v.status || 'visiting'; document.getElementById('editModal').classList.add('open') } catch (e) { alert('Erro ao carregar lead') } }
    function closeEdit() { document.getElementById('editModal').classList.remove('open'); editingVid = '' }
    async function saveEdit() { if (!editingVid) return; var data = { name: document.getElementById('ed-name').value, email: document.getElementById('ed-email').value, phone: document.getElementById('ed-phone').value, instagram: document.getElementById('ed-instagram').value, empresa: document.getElementById('ed-empresa').value, city: document.getElementById('ed-city').value, state: document.getElementById('ed-state').value, status: document.getElementById('ed-status').value }; try { await api('/leads/' + encodeURIComponent(editingVid), { method: 'PUT', body: data }); closeEdit(); loadLeads(); loadStats() } catch (e) { alert('Erro ao salvar') } }
    async function deleteLead(vid, name) { if (!confirm('Excluir "' + name + '" e todos os dados?\n\nN√£o pode ser desfeito!')) return; try { await api('/leads/' + encodeURIComponent(vid), { method: 'DELETE' }); loadLeads(); loadStats(); loadCharts() } catch (e) { alert('Erro ao excluir') } }
    async function deleteAllLeads() { var r = prompt('‚ö†Ô∏è CUIDADO!\n\nIsso vai excluir TODOS os leads.\nDigite "DELETAR_TUDO" para confirmar:'); if (r !== 'DELETAR_TUDO') return; try { await api('/leads', { method: 'DELETE', headers: { 'X-Confirm-Delete': 'DELETAR_TUDO' } }); loadLeads(); loadStats(); loadCharts(); alert('‚úÖ Todos os leads exclu√≠dos.') } catch (e) { alert('Erro') } }

    // ‚ïê‚ïê‚ïê PROJETOS ‚ïê‚ïê‚ïê
    async function loadProjects() { try { projectsData = await api('/projects'); renderProjects(); updateProjectDropdown(); updateScriptSnippet() } catch (e) { document.getElementById('projectsBody').innerHTML = '<tr><td colspan="6" class="empty">Erro ao carregar projetos</td></tr>' } }
    function renderProjects() { var tb = document.getElementById('projectsBody'); if (!projectsData.length) { tb.innerHTML = '<tr><td colspan="6" class="empty">Nenhum projeto encontrado</td></tr>'; return } tb.innerHTML = projectsData.map(function (p) { var atk = p.fb_access_token ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '‚Äî'; return '<tr class="lr"><td>' + p.id + '</td><td>' + esc(p.name) + '</td><td>' + esc(p.fb_pixel_id) + '</td><td>' + esc(atk) + '</td><td>' + fmtDT(p.created_at) + '</td><td><div class="act-btns"><button class="act-btn act-edit" onclick="editProject(' + p.id + ')">‚úèÔ∏è</button><button class="act-btn act-del" onclick="deleteProject(' + p.id + ',\'' + esc(p.name).replace(/'/g, "\\'") + '\')">üóë</button></div></td></tr>' }).join('') }
    function updateProjectDropdown() { var sel = document.getElementById('globalProjectSelector'); var html = '<option value="all">Todos os Projetos</option>' + projectsData.map(function (p) { return '<option value="' + p.id + '">' + esc(p.name) + '</option>' }).join(''); sel.innerHTML = html; sel.value = curProject }
    function changeGlobalProject(pid) { curProject = pid; loadAll(); updateScriptSnippet() }
    function updateScriptSnippet() { var p = projectsData.find(function (x) { return x.id == curProject }); if (!p) p = projectsData[0]; var pix = p ? p.fb_pixel_id : '[SEU_PIXEL_ID]'; var pid = p ? p.id : '1'; var box = document.getElementById('scriptBox'); if (box) box.innerHTML = '<button class="copy-btn" onclick="copyScript()">Copiar</button>&lt;!-- Meta Pixel --&gt;<br>&lt;script&gt;<br>!function(f,b,e,v,n,t,s){...}(window,document,\'script\',\'https://connect.facebook.net/en_US/fbevents.js\');<br>fbq(\'init\',\'' + pix + '\');<br>&lt;/script&gt;<br><br>&lt;!-- Worki Tracker --&gt;<br>&lt;script src="https://tracker.workidigital.tech/public/wk.js" data-project="' + pid + '" async&gt;&lt;/script&gt;'; }
    function openProjectModal() { document.getElementById('projId').value = ''; document.getElementById('projName').value = ''; document.getElementById('projPixel').value = ''; document.getElementById('projToken').value = ''; document.getElementById('projModalTitle').textContent = 'Novo Projeto'; document.getElementById('projectModal').classList.add('open') }
    function closeProjectModal() { document.getElementById('projectModal').classList.remove('open') }
    function editProject(id) { var p = projectsData.find(function (x) { return x.id == id }); if (!p) return; document.getElementById('projId').value = p.id; document.getElementById('projName').value = p.name || ''; document.getElementById('projPixel').value = p.fb_pixel_id || ''; document.getElementById('projToken').value = p.fb_access_token || ''; document.getElementById('projModalTitle').textContent = 'Editar Projeto'; document.getElementById('projectModal').classList.add('open') }
    async function saveProject() { var id = document.getElementById('projId').value; var d = { name: document.getElementById('projName').value, fb_pixel_id: document.getElementById('projPixel').value, fb_access_token: document.getElementById('projToken').value }; try { if (id) { await api('/projects/' + id, { method: 'PUT', body: d }) } else { await api('/projects', { method: 'POST', body: d }) } closeProjectModal(); await loadProjects(); loadAll() } catch (e) { alert('Erro ao salvar projeto') } }
    async function deleteProject(id, name) { if (!confirm('Excluir projeto "' + name + '"? Isso n√£o apagar√° os leads, mas o script falhar√° se n√£o for atualizado.')) return; try { await api('/projects/' + id, { method: 'DELETE' }); if (curProject == id) curProject = 'all'; await loadProjects(); loadAll() } catch (e) { alert('Erro ao excluir projeto') } }

    function loadAll() { loadProjects().then(function () { loadStats(); loadCharts(); if (document.getElementById('panel-leads').classList.contains('active')) loadLeads() }) }
    (function () { var t = new Date(); dateTo = t.toISOString().split('T')[0]; dateFrom = new Date(t - 7 * 864e5).toISOString().split('T')[0]; document.getElementById('df').value = dateFrom; document.getElementById('dt').value = dateTo })();
    loadAll(); setInterval(loadStats, 30000); loadRealtime();
    if (localStorage.getItem('wk_sidebar') === '1') document.getElementById('sidebar').classList.add('collapsed');
    switchTab('projects');
  </script>
</body>

</html>